<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>哈雷0V0的小仓库 | 资源中心</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://fastlist-css.pages.dev/css2.css">
  <link rel="stylesheet" href="https://fastlist-css.pages.dev/css.css">
  <style>
    /* css */
    :root {
      --primary: #0067C0;
      --on-primary: #FFFFFF;
      --primary-container: #D3E5FF;
      --on-primary-container: #001D36;
      
      --secondary: #535F70;
      --on-secondary: #FFFFFF;
      --secondary-container: #D7E3F7;
      --on-secondary-container: #101C2B;
      
      --surface: #F9F9FA;
      --on-surface: #1A1C1E;
      --surface-variant: #DFE2EB;
      --on-surface-variant: #43474E;
      
      --background: #F9F9FA;
      --on-background: #1A1C1E;
      
      --outline: #74777F;
      --outline-variant: #C4C6D0;
      
      --error: #BA1A1A;
      --on-error: #FFFFFF;
      --error-container: #FFDAD6;
      --on-error-container: #410002;
      
      --success: #0C7D60;
      --on-success: #FFFFFF;
      --success-container: #A6F2DB;
      --on-success-container: #002116;
      
      --warning: #E6B400;
      --on-warning: #FFFFFF;
      --warning-container: #FFE9A3;
      --on-warning-container: #4C3D00;
      
      --elevation-1: 0 1px 2px rgba(0, 0, 0, 0.05), 0 1px 3px rgba(0, 0, 0, 0.1);
      --elevation-2: 0 2px 6px rgba(0, 0, 0, 0.05), 0 3px 6px rgba(0, 0, 0, 0.1);
      --elevation-3: 0 4px 12px rgba(0, 0, 0, 0.05), 0 6px 12px rgba(0, 0, 0, 0.1);
      
      --radius-sm: 6px;
      --radius-md: 10px;
      --radius-lg: 14px;
      --radius-xl: 18px;
      --radius-xxl: 28px;
      
      --spacing-xs: 4px;
      --spacing-sm: 8px;
      --spacing-md: 16px;
      --spacing-lg: 24px;
      --spacing-xl: 32px;
      --spacing-xxl: 48px;
      
      --transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      
      --icon-size-sm: 18px;
      --icon-size-md: 24px;
      --icon-size-lg: 32px;
    }

    /* 暗色主题 */
    [data-theme="dark"] {
      --primary: #A8C8FF;
      --on-primary: #003059;
      --primary-container: #00497E;
      --on-primary-container: #D3E5FF;
      
      --secondary: #BBC7DB;
      --on-secondary: #253140;
      --secondary-container: #3B4858;
      --on-secondary-container: #D7E3F7;
      
      --surface: #121316;
      --on-surface: #E2E2E5;
      --surface-variant: #43474E;
      --on-surface-variant: #C4C6D0;
      
      --background: #121316;
      --on-background: #E2E2E5;
      
      --outline: #8E9199;
      --outline-variant: #43474E;
      
      --error: #FFB4AB;
      --on-error: #690005;
      --error-container: #93000A;
      --on-error-container: #FFDAD6;
      
      --success: #88D8BF;
      --on-success: #00382A;
      --success-container: #00503F;
      --on-success-container: #A6F2DB;
      
      --warning: #FFDC48;
      --on-warning: #3D3000;
      --warning-container: #5F4E00;
      --on-warning-container: #FFE9A3;
      
      --elevation-1: 0 1px 2px rgba(0, 0, 0, 0.2), 0 1px 3px rgba(0, 0, 0, 0.3);
      --elevation-2: 0 2px 6px rgba(0, 0, 0, 0.2), 0 3px 6px rgba(0, 0, 0, 0.3);
      --elevation-3: 0 4px 12px rgba(0, 0, 0, 0.2), 0 6px 12px rgba(0, 0, 0, 0.3);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Roboto', 'Segoe UI', system-ui, sans-serif;
      transition: background-color var(--transition), color var(--transition), border-color var(--transition);
    }
    
    body {
      background-color: var(--background);
      color: var(--on-background);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      line-height: 1.5;
      padding: var(--spacing-md);
    }
    
    .container {
      max-width: 1300px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1fr;
      gap: var(--spacing-lg);
      padding-bottom: var(--spacing-xl);
    }

    @media (min-width: 768px) {
      .container {
        grid-template-columns: 1.2fr 0.8fr;
      }
    }

    header {
      grid-column: 1 / -1;
      text-align: center;
      margin: var(--spacing-xl) 0;
      position: relative;
    }

    .logo {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-md);
      margin-bottom: var(--spacing-sm);
    }

    .logo-icon {
      background: var(--primary);
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .logo-icon i {
      font-size: 28px;
      color: var(--on-primary);
    }

    h1 {
      color: var(--primary);
      font-size: 2.5rem;
      margin-bottom: var(--spacing-sm);
    }

    .theme-switcher {
      position: fixed;
      top: var(--spacing-md);
      right: var(--spacing-md);
      z-index: 1000;
      display: flex;
      gap: var(--spacing-sm);
    }

    .theme-toggle {
      position: relative;
      width: 48px;
      height: 24px;
      background: var(--surface-variant);
      border-radius: var(--radius-xxl);
      cursor: pointer;
      display: flex;
      align-items: center;
      padding: 2px;
      transition: background-color var(--transition);
    }
    
    .theme-toggle::before {
      content: '';
      position: absolute;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--primary);
      left: 2px;
      transition: transform var(--transition);
    }
    
    [data-theme="dark"] .theme-toggle::before {
      transform: translateX(24px);
    }
    
    .theme-icon {
      position: relative;
      z-index: 1;
      font-size: var(--icon-size-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      width: 20px;
      height: 20px;
      color: var(--on-primary);
    }
    
    .light-icon {
      opacity: 1;
      transition: opacity var(--transition);
    }
    
    .dark-icon {
      opacity: 0;
      transition: opacity var(--transition);
    }
    
    [data-theme="dark"] .light-icon {
      opacity: 0;
    }
    
    [data-theme="dark"] .dark-icon {
      opacity: 1;
    }

    .card {
      background: var(--surface);
      border-radius: var(--radius-xl);
      box-shadow: var(--elevation-1);
      padding: var(--spacing-xl);
      margin-bottom: var(--spacing-xl);
      transition: box-shadow var(--transition), transform var(--transition);
    }
    
    .card:hover {
      box-shadow: var(--elevation-2);
    }

    .announcement-section {
      grid-column: 1 / -1;
      background: var(--warning-container);
      padding: var(--spacing-lg);
      border-radius: var(--radius-lg);
      margin-bottom: var(--spacing-md);
    }

    .announcement-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-md);
    }

    .announcement-title {
      color: var(--on-warning-container);
      margin: 0;
      font-size: 1.4rem;
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }

    .refresh-button {
      background: rgba(255, 255, 255, 0.3);
      border: 1px solid var(--on-warning-container);
      color: var(--on-warning-container);
      padding: var(--spacing-sm) var(--spacing-md);
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: var(--transition);
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
    }

    .refresh-button:hover {
      background: var(--on-warning-container);
      color: var(--warning-container);
    }

    .section-title {
      color: var(--primary);
      padding-bottom: var(--spacing-md);
      margin-top: 0;
      margin-bottom: var(--spacing-lg);
      font-size: 1.6rem;
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      border-bottom: 1px solid var(--outline-variant);
    }

    .section-title i {
      font-size: 1.4rem;
    }

    .release {
      background-color: var(--surface-variant);
      padding: var(--spacing-lg);
      margin: var(--spacing-lg) 0;
      border-radius: var(--radius-lg);
      border: 1px solid var(--outline-variant);
      transition: var(--transition);
    }

    .release-header h3 {
      color: var(--primary);
      margin-bottom: var(--spacing-sm);
      font-size: 1.3rem;
    }

    .release-meta {
      display: flex;
      gap: var(--spacing-lg);
      color: var(--on-surface-variant);
      margin-bottom: var(--spacing-md);
      font-size: 0.95rem;
    }

    .download-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--spacing-md);
      margin: var(--spacing-sm) 0;
      background: var(--surface);
      border-radius: var(--radius-md);
      border: 1px solid var(--outline-variant);
      transition: var(--transition);
    }

    .download-item:hover {
      transform: translateX(5px);
      border-left: 4px solid var(--primary);
    }

    .file-info {
      flex: 1;
    }

    .file-name {
      font-weight: 600;
      display: block;
      margin-bottom: var(--spacing-xs);
      font-size: 1.1rem;
      color: var(--primary);
    }

    .file-size {
      color: var(--on-surface-variant);
      font-size: 0.9rem;
    }

    .download-options {
      display: flex;
      gap: var(--spacing-sm);
    }

    .download-link {
      padding: var(--spacing-sm) var(--spacing-md);
      border-radius: var(--radius-sm);
      text-decoration: none;
      transition: var(--transition);
      font-size: 0.95rem;
      font-weight: 500;
      white-space: nowrap;
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
    }

    .download-link:not(.accelerated) {
      background: var(--surface-variant);
      color: var(--on-surface-variant);
      border: 1px solid var(--outline-variant);
    }

    .download-link:not(.accelerated):hover {
      background: var(--outline-variant);
    }

    .download-link.accelerated {
      background: var(--primary);
      color: var(--on-primary);
      border: 1px solid var(--primary);
    }

    .download-link.accelerated:hover {
      opacity: 0.9;
    }

    .toggle-assets {
      background: var(--primary);
      color: var(--on-primary);
      padding: var(--spacing-sm) var(--spacing-md);
      border: none;
      border-radius: var(--radius-sm);
      cursor: pointer;
      font-family: inherit;
      font-weight: 600;
      transition: var(--transition);
      margin-top: var(--spacing-md);
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
    }

    .toggle-assets:hover {
      opacity: 0.9;
    }

    .quick-create {
      background: var(--surface-variant);
      padding: var(--spacing-lg);
      border-radius: var(--radius-lg);
      margin: var(--spacing-lg) 0;
      border: 1px solid var(--outline-variant);
      transition: var(--transition);
    }

    .form-input, .form-textarea {
      width: 100%;
      padding: var(--spacing-md);
      margin: var(--spacing-sm) 0;
      border: 1px solid var(--outline-variant);
      border-radius: var(--radius-md);
      box-sizing: border-box;
      font-family: inherit;
      transition: var(--transition);
      font-size: 1rem;
      background: var(--surface);
      color: var(--on-surface);
    }

    .form-input:focus, .form-textarea:focus {
      border-color: var(--primary);
      outline: none;
    }

    .submit-button {
      background: var(--primary);
      color: var(--on-primary);
      padding: var(--spacing-md) var(--spacing-lg);
      border: none;
      border-radius: var(--radius-md);
      cursor: pointer;
      font-family: inherit;
      font-weight: 600;
      transition: var(--transition);
      font-size: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-xs);
      margin-top: var(--spacing-sm);
    }

    .submit-button:hover {
      opacity: 0.9;
    }

    .issue {
      margin: var(--spacing-lg) 0;
      padding: var(--spacing-lg);
      background: var(--surface);
      border: 1px solid var(--outline-variant);
      border-radius: var(--radius-lg);
      transition: var(--transition);
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
      margin-bottom: var(--spacing-md);
    }

    .avatar {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid var(--primary);
      padding: 2px;
    }

    .comment {
      margin: var(--spacing-lg) 0;
      padding: var(--spacing-lg);
      background: var(--surface-variant);
      border-radius: var(--radius-md);
      display: flex;
      gap: var(--spacing-lg);
      transition: var(--transition);
      border: 1px solid var(--outline-variant);
    }

    .comment:hover {
      transform: translateX(5px);
      border-left: 3px solid var(--primary);
    }

    .comment-content {
      flex-grow: 1;
    }

    .comment-author {
      font-weight: 600;
      color: var(--primary);
      font-size: 1.1rem;
    }

    .comment-date {
      color: var(--on-surface-variant);
      font-size: 0.85rem;
      margin-top: 3px;
    }

    .comments-container {
      margin-top: var(--spacing-lg);
      border-top: 1px solid var(--outline-variant);
      padding-top: var(--spacing-lg);
    }

    .disclaimer-section {
      grid-column: 1 / -1;
      margin-top: var(--spacing-xl);
      padding: var(--spacing-lg);
      background: var(--surface-variant);
      border-radius: var(--radius-lg);
      border: 1px solid var(--outline-variant);
      font-size: 0.95rem;
      color: var(--on-surface-variant);
      text-align: center;
    }

    .disclaimer-link {
      color: var(--primary);
      text-decoration: none;
      font-weight: 600;
      transition: var(--transition);
      border-bottom: 1px dashed var(--primary);
    }

    .disclaimer-link:hover {
      border-bottom-style: solid;
    }

    .loading-text {
      text-align: center;
      color: var(--on-surface-variant);
      padding: var(--spacing-xl);
      font-size: 1.1rem;
    }

    .loading-text i {
      margin-right: var(--spacing-sm);
      animation: spin 1.5s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .stats-bar {
      display: flex;
      justify-content: space-around;
      padding: var(--spacing-md);
      background: var(--surface);
      border-radius: var(--radius-lg);
      margin: var(--spacing-lg) 0;
      grid-column: 1 / -1;
      border: 1px solid var(--outline-variant);
    }

    .stat-item {
      text-align: center;
      padding: var(--spacing-sm);
    }

    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: var(--spacing-xs);
    }

    .stat-label {
      color: var(--on-surface-variant);
      font-size: 0.95rem;
    }

    .footer {
      grid-column: 1 / -1;
      text-align: center;
      padding: var(--spacing-lg);
      margin-top: var(--spacing-lg);
      color: var(--on-surface-variant);
      font-size: 0.9rem;
      border-top: 1px solid var(--outline-variant);
    }

    /* 新增样式 */
    .github-stats {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-md);
      margin-top: var(--spacing-sm);
    }
    
    .github-stat {
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
      color: var(--on-surface-variant);
      font-size: 0.95rem;
    }
    
    .github-stat i {
      color: var(--primary);
    }
    
    .release-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: var(--spacing-lg);
    }
    
    .discussion-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: var(--spacing-lg);
    }
    
    @media (min-width: 768px) {
      .release-grid {
        grid-template-columns: 1fr;
      }
      
      .discussion-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      body {
        padding: var(--spacing-sm);
      }
      
      h1 {
        font-size: 2.2rem;
      }
      
      .section-title {
        font-size: 1.5rem;
      }
      
      .download-item {
        flex-direction: column;
        align-items: flex-start;
        gap: var(--spacing-md);
      }

      .download-options {
        width: 100%;
        flex-direction: column;
      }
      
      .download-link {
        width: 100%;
        text-align: center;
        justify-content: center;
      }
      
      .stats-bar {
        flex-direction: column;
        gap: var(--spacing-md);
      }
    }

    .lang-toggle {
      display: flex;
      gap: 4px;
      align-items: center;
    }
    .lang-btn {
      background: var(--surface-variant);
      color: var(--on-surface-variant);
      border: 1px solid var(--outline-variant);
      border-radius: var(--radius-sm);
      padding: 4px 12px;
      cursor: pointer;
      font-size: 0.95rem;
      font-weight: 600;
      transition: var(--transition);
    }
    .lang-btn.active,
    .lang-btn:hover {
      background: var(--primary);
      color: var(--on-primary);
      border: 1px solid var(--primary);
    }
  </style>
</head>
<body>
  <div class="theme-switcher">
    <div class="theme-toggle" onclick="toggleTheme()">
      <span class="theme-icon light-icon"><i class="fas fa-sun"></i></span>
      <span class="theme-icon dark-icon"><i class="fas fa-moon"></i></span>
    </div>
    <div class="lang-toggle">
      <button class="lang-btn" onclick="switchLang('zh')" id="lang-zh">中文</button>
      <button class="lang-btn" onclick="switchLang('en')" id="lang-en">EN</button>
    </div>
  </div>

  <header>
    <div class="logo">
      <div class="logo-icon">
        <i class="fas fa-cloud"></i>
      </div>
      <h1>哈雷0V0的小仓库</h1>
    </div>
    <div class="github-stats">
      <div class="github-stat">
        <i class="fab fa-github"></i>
        <span id="github-stars">加载中...</span> stars
      </div>
      <div class="github-stat">
        <i class="fas fa-code-branch"></i>
        <span id="github-forks">加载中...</span> forks
      </div>
    </div>
  </header>
  
  <div class="container">
    <div class="announcement-section card">
      <div class="announcement-header">
        <h2 class="announcement-title"><i class="fas fa-bullhorn"></i> 公告</h2>
        <button class="refresh-button" onclick="fetchAnnouncement()">
          <i class="fas fa-sync-alt"></i> 刷新
        </button>
      </div>
      <div id="announcement-content">
        <div class="loading-text"><i class="fas fa-spinner"></i> 加载公告中...</div>
      </div>
    </div>

    <div class="stats-bar card">
      <div class="stat-item">
        <div class="stat-value" id="release-count">0</div>
        <div class="stat-label">资源发布</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="file-count">0</div>
        <div class="stat-label">文件总数</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="user-count">0</div>
        <div class="stat-label">GitHub Stars</div>
      </div>
    </div>

    <!-- 主体顺序调整：文件发布 > 社区讨论 > 相关链接 -->
    <div class="card">
      <h2 class="section-title"><i class="fas fa-box-open"></i> 文件发布</h2>
      <!-- 新增搜索框 -->
      <div class="search-bar" style="margin-bottom: 24px; display: flex; gap: 12px; align-items: stretch;">
      <input type="text" id="fileSearchInput" class="form-input" style="max-width: 350px; flex: 1; height: 100%;" placeholder="搜索文件名/版本..." oninput="filterReleases()">
      <button class="submit-button" onclick="clearFileSearch()" type="button" style="flex-shrink: 0; height: 100%; display: flex; align-items: center;"><i class="fas fa-times"></i> 清空</button>
  <!-- 下载数据按钮 -->
      <button class="submit-button" onclick="showDownloadStats()" type="button" style="flex-shrink: 0; height: 100%; display: flex; align-items: center;">
    <i class="fas fa-chart-bar"></i> 下载数据
  </button>
</div>
      <div class="release-grid" id="releases">
        <div class="loading-text"><i class="fas fa-spinner"></i> 加载发布文件中...</div>
      </div>
    </div>

    <div class="card">
      <h2 class="section-title"><i class="fas fa-comments"></i> 社区讨论</h2>
      <div class="discussion-grid">
        <div class="quick-create">
          <h3 style="margin-top:0; color: var(--primary);"><i class="fas fa-pen"></i> 新建讨论</h3>
          <input type="text" id="issueTitle" 
                 placeholder="输入讨论标题（必填）" 
                 class="form-input"
                 required>
          <textarea id="issueBody" 
                    class="form-textarea"
                    placeholder="输入讨论内容（支持Markdown格式）"
                    rows="4"></textarea>
          <button onclick="createNewIssue()" 
                  class="submit-button">
            <i class="fas fa-plus-circle"></i> 创建讨论
          </button>
        </div>
        <div id="discussions">
          <div class="loading-text"><i class="fas fa-spinner"></i> 加载讨论中...</div>
        </div>
      </div>
    </div>

    <!-- 相关链接放最后 -->
    <div class="card" style="text-align:center; grid-column: 1 / -1;">
      <h2 class="section-title" style="justify-content:center;">
        <i class="fas fa-link"></i> 相关链接
      </h2>
      <a href="https://halei0v0.github.io" target="_blank" 
         style="display:inline-block;padding:14px 32px;background:var(--primary);color:var(--on-primary);border-radius:var(--radius-lg);font-size:1.1rem;font-weight:600;text-decoration:none;transition:opacity 0.2s;margin:8px;">
        <i class="fas fa-blog"></i> 哈雷0V0的博客
      </a>
      <a href="https://space.bilibili.com/524530873?spm_id_from=333.1007.0.0" target="_blank"
         style="display:inline-block;padding:14px 32px;background:#fb7299;color:#fff;border-radius:var(--radius-lg);font-size:1.1rem;font-weight:600;text-decoration:none;transition:opacity 0.2s;margin:8px;">
        <i class="fab fa-bilibili"></i> 哈雷0V0的哔哩哔哩主页
      </a>
    </div>

    <section class="disclaimer-section card">
      <strong><i class="fas fa-exclamation-circle"></i> 免责声明：</strong>
      本站所有资源均为来自于网络，不代表本站立场。下载内容仅供学习交流使用，不得用于商业用途。 
      一切后果由使用者自行承担，如需删除内容，请联系哈雷0V0

    </section>
    
    <div class="footer">
      <p>© 2025 哈雷0V0的小仓库</p>
    </div>
  </div>

  <script>
    // 新增主题功能
    function toggleTheme() {
      const currentTheme = document.body.getAttribute('data-theme') || 'light';
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      document.body.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
    }

    function initTheme() {
      const savedTheme = localStorage.getItem('theme') || 
                        (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
      document.body.setAttribute('data-theme', savedTheme);
    }

    // 获取GitHub仓库信息
    async function fetchGitHubStats() {
      try {
        const response = await fetch('https://api.github.com/repos/halei0v0/halei-s-warehouse');
        if (!response.ok) throw new Error('获取GitHub信息失败');
        
        const data = await response.json();
        document.getElementById('github-stars').textContent = data.stargazers_count;
        document.getElementById('github-forks').textContent = data.forks_count;
        document.getElementById('user-count').textContent = data.stargazers_count;
      } catch (error) {
        console.error('获取GitHub数据失败:', error);
        document.getElementById('github-stars').textContent = 'N/A';
        document.getElementById('github-forks').textContent = 'N/A';
        document.getElementById('user-count').textContent = 'N/A';
      }
    }

    async function initialize() {
      initTheme();
      try {
        await Promise.all([
          fetchAnnouncement(),
          fetchReleases(),
          fetchDiscussions(),
          fetchGitHubStats()
        ]);
      } catch (error) {
        showErrorNotification(`初始化失败: ${error.message}`);
      }
    }

    // 公告
    async function fetchAnnouncement() {
      const contentDiv = document.getElementById('announcement-content');
      try {
        contentDiv.innerHTML = `<div class="loading-text"><i class="fas fa-spinner"></i> ${langData[currentLang].loading}</div>`;
        const response = await fetch('https://raw.githubusercontent.com/halei0v0/halei-s-warehouse/main/home.txt');
        if (!response.ok) throw new Error(`HTTP错误! 状态码: ${response.status}`);
        const text = await response.text();
        contentDiv.innerHTML = (text || langData[currentLang].announcement).replace(/\n/g, '<br>');
      } catch (error) {
        contentDiv.innerHTML = `
          <div class="error-text">
            <i class="fas fa-exclamation-triangle"></i> ${escapeHtml(error.message)}
            <button onclick="fetchAnnouncement()" class="refresh-button" style="margin-top:10px;">
              <i class="fas fa-redo"></i> ${langData[currentLang].retry}
            </button>
          </div>
        `;
      }
    }

    // 完整文件发布功能
    let allReleasesCache = []; // 缓存所有release数据

    async function fetchReleases() {
      try {
        const response = await fetch('https://api.github.com/repos/halei0v0/halei-s-warehouse/releases');
        if (!response.ok) throw new Error('获取发布信息失败');
        
        const releases = await response.json();
        allReleasesCache = releases; // 缓存
        renderReleases(releases);

        // 更新统计信息
        document.getElementById('release-count').textContent = releases.length;
        const totalFiles = releases.reduce((acc, release) => acc + release.assets.length, 0);
        document.getElementById('file-count').textContent = totalFiles;
      } catch (error) {
        showErrorNotification(`文件加载失败: ${error.message}`);
      }
    }

    // 下载量存储与显示
    function getDownloadCounts() {
      // 本地存储结构: { "asset_url": count, ... }
      try {
        return JSON.parse(localStorage.getItem('downloadCounts') || '{}');
      } catch {
        return {};
      }
    }
    function setDownloadCounts(counts) {
      localStorage.setItem('downloadCounts', JSON.stringify(counts));
    }
    function incrementDownloadCount(assetUrl) {
      const counts = getDownloadCounts();
      counts[assetUrl] = (counts[assetUrl] || 0) + 1;
      setDownloadCounts(counts);
      // 更新页面显示
      updateDownloadCountDisplay(assetUrl);
    }
    function updateDownloadCountDisplay(assetUrl) {
      const els = document.querySelectorAll(`[data-asset-url="${assetUrl}"] .download-count`);
      const counts = getDownloadCounts();
      els.forEach(el => {
        el.textContent = counts[assetUrl] || 0;
      });
    }
    function updateAllDownloadCounts() {
      const counts = getDownloadCounts();
      document.querySelectorAll('.download-item').forEach(item => {
        const assetUrl = item.getAttribute('data-asset-url');
        if (assetUrl) {
          const count = counts[assetUrl] || 0;
          const countEl = item.querySelector('.download-count');
          if (countEl) countEl.textContent = count;
        }
      });
    }

    // 获取某个release下所有文件的总下载量
    function getReleaseTotalDownloads(release) {
      const counts = getDownloadCounts();
      return release.assets.reduce((sum, asset) => sum + (counts[asset.browser_download_url] || 0), 0);
    }

    // 修改renderReleases，增加每个release的总下载量显示
    function renderReleases(releases) {
      const container = document.getElementById('releases');
      if (!releases.length) {
        container.innerHTML = `<div class="loading-text"><i class="fas fa-info-circle"></i> ${langData[currentLang].noFiles}</div>`;
        return;
      }
      container.innerHTML = releases.map(release => {
        return `
          <div class="release">
            <div class="release-header">
              <h3><i class="fas fa-tag"></i> ${escapeHtml(release.name)}</h3>
              <div class="release-meta">
                <span><i class="fas fa-code-branch"></i> ${langData[currentLang].version}：${escapeHtml(release.tag_name)}</span>
                <span><i class="fas fa-calendar-alt"></i> ${langData[currentLang].published}：${new Date(release.published_at).toLocaleDateString()}</span>
              </div>
            </div>
            <div style="display: flex; gap: 12px; align-items: flex-start; margin-bottom: 8px;">
              <button class="submit-button toggle-desc" style="margin-top:0;">
                <i class="fas fa-info-circle"></i> ${currentLang === 'zh' ? '显示简介' : 'Show Description'}
              </button>
              <button class="submit-button toggle-assets" style="margin-top:0;">
                <i class="fas fa-layer-group"></i> ${langData[currentLang].showAssets}
              </button>
            </div>
            <div class="release-description" style="margin:0 0 12px 0; color:var(--on-surface-variant); font-size:1rem; display:none;">
              ${release.body ? release.body.replace(/\n/g, '<br>') : `<span style="color:#bbb;">${langData[currentLang].noContent}</span>`}
            </div>
            <ul class="assets" style="display:none;">
              ${release.assets.map(asset => `
                <li class="download-item" data-asset-url="${asset.browser_download_url}">
                  <div class="file-info">
                    <span class="file-name"><i class="fas fa-file"></i> ${escapeHtml(asset.name)}</span>
                    <span class="file-size"><i class="fas fa-database"></i> ${formatFileSize(asset.size)}</span>
                  </div>
                  <div class="download-options">
                    <a href="${asset.browser_download_url}" class="download-link" onclick="incrementDownloadCount('${asset.browser_download_url}')">
                      <i class="fas fa-download"></i> ${langData[currentLang].normalDownload}
                    </a>
                    <a href="${generateProxyUrl(asset.browser_download_url)}" 
                       class="download-link accelerated" onclick="incrementDownloadCount('${asset.browser_download_url}')">
                      <i class="fas fa-bolt"></i> ${langData[currentLang].fastDownload}
                    </a>
                  </div>
                </li>
              `).join('')}
            </ul>
          </div>
        `;
      }).join('');

      // 简介收起/展开
      document.querySelectorAll('.toggle-desc').forEach(button => {
        button.addEventListener('click', function() {
          const desc = this.parentElement.nextElementSibling;
          const isShow = desc.style.display === 'block';
          desc.style.display = isShow ? 'none' : 'block';
          this.innerHTML = isShow
            ? `<i class="fas fa-info-circle"></i> ${currentLang === 'zh' ? '显示简介' : 'Show Description'}`
            : `<i class="fas fa-info-circle"></i> ${currentLang === 'zh' ? '收起简介' : 'Hide Description'}`;
        });
      });

      // 资源收起/展开
      document.querySelectorAll('.toggle-assets').forEach(button => {
        button.addEventListener('click', function() {
          const assetsList = this.parentElement.parentElement.querySelector('.assets');
          assetsList.style.display = assetsList.style.display === 'none' ? 'block' : 'none';
          this.innerHTML = assetsList.style.display === 'none' ? 
            `<i class="fas fa-layer-group"></i> ${langData[currentLang].showAssets}` : 
            `<i class="fas fa-layer-group"></i> ${langData[currentLang].hideAssets}`;
        });
      });
    }

    // 下载量统计弹窗
    function showDownloadStats() {
      const counts = getDownloadCounts();
      let total = 0;
      let html = `<h3 style="margin-top:0;"><i class="fas fa-chart-bar"></i> 下载数据统计</h3>`;
      html += `<table style="width:100%;border-collapse:collapse;margin-top:12px;">
        <thead>
          <tr style="background:#f5f5f5;">
            <th style="padding:8px;border:1px solid #ddd;">文件名</th>
            <th style="padding:8px;border:1px solid #ddd;">下载量</th>
            <th style="padding:8px;border:1px solid #ddd;">操作</th>
          </tr>
        </thead>
        <tbody>`;
      Object.entries(counts).forEach(([url, count]) => {
        total += count;
        // 尝试获取文件名
        const name = decodeURIComponent(url.split('/').pop());
        html += `<tr>
          <td style="padding:8px;border:1px solid #ddd;">${escapeHtml(name)}</td>
          <td style="padding:8px;border:1px solid #ddd;">${count}</td>
          <td style="padding:8px;border:1px solid #ddd;">
            <a href="${url}" target="_blank" style="background:var(--primary);color:#fff;padding:6px 16px;border-radius:6px;text-decoration:none;font-weight:600;transition:opacity 0.2s;">
              <i class="fas fa-download"></i> 下载
            </a>
          </td>
        </tr>`;
      });
      html += `</tbody></table>`;
      html += `<div style="margin-top:16px;font-weight:600;">总下载量：${total}</div>`;

      // 弹窗
      const modal = document.createElement('div');
      modal.style.position = 'fixed';
      modal.style.top = '0';
      modal.style.left = '0';
      modal.style.width = '100vw';
      modal.style.height = '100vh';
      modal.style.background = 'rgba(0,0,0,0.3)';
      modal.style.zIndex = '99999';
      modal.style.display = 'flex';
      modal.style.alignItems = 'center';
      modal.style.justifyContent = 'center';

      const box = document.createElement('div');
      box.style.background = '#fff';
      box.style.padding = '32px 24px';
      box.style.borderRadius = '12px';
      box.style.minWidth = '320px';
      box.style.maxWidth = '90vw';
      box.style.maxHeight = '80vh';
      box.style.overflowY = 'auto';
      box.style.boxShadow = '0 4px 24px rgba(0,0,0,0.15)';
      box.innerHTML = html + `<button style="margin-top:24px;padding:10px 24px;background:var(--primary);color:#fff;border:none;border-radius:8px;cursor:pointer;font-size:1rem;" onclick="this.parentElement.parentElement.remove()">关闭</button>`;

      modal.appendChild(box);
      document.body.appendChild(modal);
    }

    // 语言切换功能
    const langData = {
      zh: {
        title: "哈雷0V0的小仓库 | 资源中心",
        mainTitle: "哈雷0V0的小仓库",
        stars: "stars",
        forks: "forks",
        announcement: "公告",
        refresh: "刷新",
        loadingAnnouncement: "加载公告中...",
        release: "文件发布",
        searchPlaceholder: "搜索文件名/版本...",
        clear: "清空",
        loadingFiles: "加载发布文件中...",
        noFiles: "没有匹配的文件",
        version: "版本",
        published: "发布时间",
        normalDownload: "普通下载",
        fastDownload: "高速下载",
        showAssets: "显示资源",
        hideAssets: "隐藏资源",
        resourceRelease: "资源发布",
        fileCount: "文件总数",
        userCount: "GitHub Stars",
        discussion: "社区讨论",
        newDiscussion: "新建讨论",
        discussionTitle: "输入讨论标题（必填）",
        discussionBody: "输入讨论内容（支持Markdown格式）",
        createDiscussion: "创建讨论",
        loadingDiscussion: "加载讨论中...",
        showComments: n => `显示评论 (${n})`,
        hideComments: n => `隐藏评论 (${n})`,
        loading: "加载中...",
        relatedLinks: "相关链接",
        blog: "哈雷0V0的博客",
        bilibili: "哈雷0V0的哔哩哔哩主页",
        disclaimer: "免责声明：",
        disclaimerText: "本站所有资源均为来自于网络，不代表本站立场。下载内容仅供学习交流使用，不得用于商业用途。一切后果由使用者自行承担，如需删除内容，请联系哈雷0V0",
        copyright: "© 2025 哈雷0V0的小仓库",
        error: "错误",
        success: "成功",
        pleaseTitle: "请填写讨论标题",
        createSuccess: "讨论创建成功！请在GitHub页面完成提交",
        noContent: "无内容描述",
        noComment: "无评论内容",
        retry: "重试"
      },
      en: {
        title: "Halei0V0's Warehouse | Resource Center",
        mainTitle: "Halei0V0's Warehouse",
        stars: "stars",
        forks: "forks",
        announcement: "Announcement",
        refresh: "Refresh",
        loadingAnnouncement: "Loading announcement...",
        release: "Releases",
        searchPlaceholder: "Search file/version...",
        clear: "Clear",
        loadingFiles: "Loading releases...",
        noFiles: "No matching files",
        version: "Version",
        published: "Published",
        normalDownload: "Normal Download",
        fastDownload: "Fast Download",
        showAssets: "Show Assets",
        hideAssets: "Hide Assets",
        resourceRelease: "Releases",
        fileCount: "Files",
        userCount: "GitHub Stars",
        discussion: "Discussion",
        newDiscussion: "New Discussion",
        discussionTitle: "Enter discussion title (required)",
        discussionBody: "Enter discussion content (Markdown supported)",
        createDiscussion: "Create Discussion",
        loadingDiscussion: "Loading discussions...",
        showComments: n => `Show Comments (${n})`,
        hideComments: n => `Hide Comments (${n})`,
        loading: "Loading...",
        relatedLinks: "Links",
        blog: "Halei0V0's Blog",
        bilibili: "Halei0V0's Bilibili",
        disclaimer: "Disclaimer:",
        disclaimerText: "All resources are from the Internet and do not represent the site's position. Downloads are for study and communication only, not for commercial use. All consequences are borne by the user. For removal, please contact Halei0V0.",
        copyright: "© 2025 Halei0V0's Warehouse",
        error: "Error",
        success: "Success",
        pleaseTitle: "Please enter discussion title",
        createSuccess: "Discussion created! Please complete submission on GitHub",
        noContent: "No description",
        noComment: "No comment",
        retry: "Retry"
      }
    };
    let currentLang = localStorage.getItem('lang') || 'zh';

    function switchLang(lang) {
      if (!langData[lang]) return;
      currentLang = lang;
      localStorage.setItem('lang', lang);
      updateLangUI();
    }

    function updateLangUI() {
      // 按钮高亮
      document.getElementById('lang-zh').classList.toggle('active', currentLang === 'zh');
      document.getElementById('lang-en').classList.toggle('active', currentLang === 'en');
      // 标题
      document.title = langData[currentLang].title;
      document.querySelector('h1').textContent = langData[currentLang].mainTitle;
      // github stats
      document.querySelectorAll('.github-stat')[0].childNodes[2].textContent = ` ${langData[currentLang].stars} `;
      document.querySelectorAll('.github-stat')[1].childNodes[2].textContent = ` ${langData[currentLang].forks} `;
      // 公告
      document.querySelector('.announcement-title').innerHTML = `<i class="fas fa-bullhorn"></i> ${langData[currentLang].announcement}`;
      document.querySelector('.refresh-button').innerHTML = `<i class="fas fa-sync-alt"></i> ${langData[currentLang].refresh}`;
      // 文件发布
      document.querySelectorAll('.section-title')[0].innerHTML = `<i class="fas fa-box-open"></i> ${langData[currentLang].release}`;
      document.getElementById('fileSearchInput').placeholder = langData[currentLang].searchPlaceholder;
      document.querySelector('.submit-button[onclick="clearFileSearch()"]').innerHTML = `<i class="fas fa-times"></i> ${langData[currentLang].clear}`;
      // 统计栏
      document.getElementById('release-count').nextElementSibling.textContent = langData[currentLang].resourceRelease;
      document.getElementById('file-count').nextElementSibling.textContent = langData[currentLang].fileCount;
      document.getElementById('user-count').nextElementSibling.textContent = langData[currentLang].userCount;
      // 讨论区
      document.querySelectorAll('.section-title')[1].innerHTML = `<i class="fas fa-comments"></i> ${langData[currentLang].discussion}`;
      document.querySelector('.quick-create h3').innerHTML = `<i class="fas fa-pen"></i> ${langData[currentLang].newDiscussion}`;
      document.getElementById('issueTitle').placeholder = langData[currentLang].discussionTitle;
      document.getElementById('issueBody').placeholder = langData[currentLang].discussionBody;
      document.querySelector('.quick-create .submit-button').innerHTML = `<i class="fas fa-plus-circle"></i> ${langData[currentLang].createDiscussion}`;
      // 相关链接
      document.querySelectorAll('.section-title')[2].innerHTML = `<i class="fas fa-link"></i> ${langData[currentLang].relatedLinks}`;
      document.querySelectorAll('.card[style*="text-align:center"] a')[0].innerHTML = `<i class="fas fa-blog"></i> ${langData[currentLang].blog}`;
      document.querySelectorAll('.card[style*="text-align:center"] a')[1].innerHTML = `<i class="fab fa-bilibili"></i> ${langData[currentLang].bilibili}`;
      // 免责声明
      document.querySelector('.disclaimer-section').innerHTML = `<strong><i class="fas fa-exclamation-circle"></i> ${langData[currentLang].disclaimer}</strong> ${langData[currentLang].disclaimerText}`;
      // 页脚
      document.querySelector('.footer p').textContent = langData[currentLang].copyright;
      // 公告内容
      if (document.getElementById('announcement-content').textContent.trim().includes('加载') ||
          document.getElementById('announcement-content').textContent.trim().includes('Loading')) {
        document.getElementById('announcement-content').innerHTML = `<div class="loading-text"><i class="fas fa-spinner"></i> ${langData[currentLang].loadingAnnouncement}</div>`;
      }
      // 文件发布加载
      if (document.getElementById('releases').textContent.trim().includes('加载') ||
          document.getElementById('releases').textContent.trim().includes('Loading')) {
        document.getElementById('releases').innerHTML = `<div class="loading-text"><i class="fas fa-spinner"></i> ${langData[currentLang].loadingFiles}</div>`;
      }
      // 讨论加载
      if (document.getElementById('discussions').textContent.trim().includes('加载') ||
          document.getElementById('discussions').textContent.trim().includes('Loading')) {
        document.getElementById('discussions').innerHTML = `<div class="loading-text"><i class="fas fa-spinner"></i> ${langData[currentLang].loadingDiscussion}</div>`;
      }
    }

    // 修改renderReleases以适配多语言
    function renderReleases(releases) {
      const container = document.getElementById('releases');
      if (!releases.length) {
        container.innerHTML = `<div class="loading-text"><i class="fas fa-info-circle"></i> ${langData[currentLang].noFiles}</div>`;
        return;
      }
      container.innerHTML = releases.map(release => {
        return `
          <div class="release">
            <div class="release-header">
              <h3><i class="fas fa-tag"></i> ${escapeHtml(release.name)}</h3>
              <div class="release-meta">
                <span><i class="fas fa-code-branch"></i> ${langData[currentLang].version}：${escapeHtml(release.tag_name)}</span>
                <span><i class="fas fa-calendar-alt"></i> ${langData[currentLang].published}：${new Date(release.published_at).toLocaleDateString()}</span>
              </div>
            </div>
            <div style="display: flex; gap: 12px; align-items: flex-start; margin-bottom: 8px;">
              <button class="submit-button toggle-desc" style="margin-top:0;">
                <i class="fas fa-info-circle"></i> ${currentLang === 'zh' ? '显示简介' : 'Show Description'}
              </button>
              <button class="submit-button toggle-assets" style="margin-top:0;">
                <i class="fas fa-layer-group"></i> ${langData[currentLang].showAssets}
              </button>
            </div>
            <div class="release-description" style="margin:0 0 12px 0; color:var(--on-surface-variant); font-size:1rem; display:none;">
              ${release.body ? release.body.replace(/\n/g, '<br>') : `<span style="color:#bbb;">${langData[currentLang].noContent}</span>`}
            </div>
            <ul class="assets" style="display:none;">
              ${release.assets.map(asset => `
                <li class="download-item" data-asset-url="${asset.browser_download_url}">
                  <div class="file-info">
                    <span class="file-name"><i class="fas fa-file"></i> ${escapeHtml(asset.name)}</span>
                    <span class="file-size"><i class="fas fa-database"></i> ${formatFileSize(asset.size)}</span>
                  </div>
                  <div class="download-options">
                    <a href="${asset.browser_download_url}" class="download-link" onclick="incrementDownloadCount('${asset.browser_download_url}')">
                      <i class="fas fa-download"></i> ${langData[currentLang].normalDownload}
                    </a>
                    <a href="${generateProxyUrl(asset.browser_download_url)}" 
                       class="download-link accelerated" onclick="incrementDownloadCount('${asset.browser_download_url}')">
                      <i class="fas fa-bolt"></i> ${langData[currentLang].fastDownload}
                    </a>
                  </div>
                </li>
              `).join('')}
            </ul>
          </div>
        `;
      }).join('');

      // 简介收起/展开
      document.querySelectorAll('.toggle-desc').forEach(button => {
        button.addEventListener('click', function() {
          const desc = this.parentElement.nextElementSibling;
          const isShow = desc.style.display === 'block';
          desc.style.display = isShow ? 'none' : 'block';
          this.innerHTML = isShow
            ? `<i class="fas fa-info-circle"></i> ${currentLang === 'zh' ? '显示简介' : 'Show Description'}`
            : `<i class="fas fa-info-circle"></i> ${currentLang === 'zh' ? '收起简介' : 'Hide Description'}`;
        });
      });

      // 资源收起/展开
      document.querySelectorAll('.toggle-assets').forEach(button => {
        button.addEventListener('click', function() {
          const assetsList = this.parentElement.parentElement.querySelector('.assets');
          assetsList.style.display = assetsList.style.display === 'none' ? 'block' : 'none';
          this.innerHTML = assetsList.style.display === 'none' ? 
            `<i class="fas fa-layer-group"></i> ${langData[currentLang].showAssets}` : 
            `<i class="fas fa-layer-group"></i> ${langData[currentLang].hideAssets}`;
        });
      });
    }

    // 文件搜索功能
    function filterReleases() {
      const keyword = document.getElementById('fileSearchInput').value.trim().toLowerCase();
      if (!keyword) {
        renderReleases(allReleasesCache);
        return;
      }
      const filtered = allReleasesCache
        .map(release => {
          // 过滤assets
          const filteredAssets = release.assets.filter(asset =>
            asset.name.toLowerCase().includes(keyword)
          );
          // 版本名或release名匹配也显示
          if (
            release.name.toLowerCase().includes(keyword) ||
            release.tag_name.toLowerCase().includes(keyword)
          ) {
            return release;
          }
          // 只显示有匹配文件的release
          if (filteredAssets.length) {
            return { ...release, assets: filteredAssets };
          }
          return null;
        })
        .filter(Boolean);
      renderReleases(filtered);
    }

    function clearFileSearch() {
      document.getElementById('fileSearchInput').value = '';
      renderReleases(allReleasesCache);
    }

    // 获取并显示讨论区
    async function fetchDiscussions() {
      try {
        const response = await fetch('https://api.github.com/repos/halei0v0/halei-s-warehouse/issues');
        const issues = await response.json();

        const container = document.getElementById('discussions');
        container.innerHTML = '';
        
        issues.forEach(issue => {
          const issueDiv = document.createElement('div');
          issueDiv.className = 'issue';
          issueDiv.innerHTML = `
            <div class="issue-header">
              <div class="user-info">
                <img src="${issue.user.avatar_url}" class="avatar" alt="${issue.user.login}">
                <div class="user-details">
                  <div class="comment-author">${issue.user.login}</div>
                  <div class="comment-date">${new Date(issue.created_at).toLocaleString()}</div>
                </div>
              </div>
              <h3><i class="fas fa-comment-dots"></i> ${issue.title}</h3>
              <p>${issue.body || langData[currentLang].noContent}</p>
              <button class="submit-button" onclick="loadComments(this, ${issue.number})"
                style="margin-top:15px;padding:10px 20px;">
                <i class="fas fa-comments"></i> ${langData[currentLang].showComments(issue.comments)}
              </button>
            </div>
            <div class="comments-container" style="display:none;"></div>
          `;
          container.appendChild(issueDiv);
        });
      } catch (error) {
        console.error('获取讨论信息失败:', error);
        showErrorNotification('加载讨论失败，请稍后重试');
      }
    }

    // 加载评论
    async function loadComments(button, issueNumber) {
      const container = button.parentElement.nextElementSibling;
      if (container.children.length === 0) {
        try {
          button.disabled = true;
          button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ' + langData[currentLang].loading;
          
          const response = await fetch(`https://api.github.com/repos/halei0v0/halei-s-warehouse/issues/${issueNumber}/comments`);
          const comments = await response.json();
          
          container.innerHTML = comments.map(comment => `
            <div class="comment">
              <img src="${comment.user.avatar_url}" class="avatar" alt="${comment.user.login}">
              <div class="comment-content">
                <div class="user-info">
                  <span class="comment-author">${comment.user.login}</span>
                  <span class="comment-date">${new Date(comment.created_at).toLocaleString()}</span>
                </div>
                <div class="comment-body">${comment.body || langData[currentLang].noComment}</div>
              </div>
            </div>
          `).join('');
          
          button.innerHTML = `<i class="fas fa-comments"></i> ${langData[currentLang].hideComments(comments.length)}`;
        } catch (error) {
          console.error('获取评论失败:', error);
          container.innerHTML = '<div class="error-text"><i class="fas fa-exclamation-triangle"></i> 无法加载评论</div>';
          button.innerHTML = `<i class="fas fa-comments"></i> ${langData[currentLang].showComments(issueNumber)}`;
        } finally {
          button.disabled = false;
        }
      }
      container.style.display = container.style.display === 'none' ? 'block' : 'none';
      button.innerHTML = container.style.display === 'none' ? 
        `<i class="fas fa-comments"></i> ${langData[currentLang].showComments(issueNumber)}` : 
        `<i class="fas fa-comments"></i> ${langData[currentLang].hideComments(container.children.length)}`;
    }

    // 创建Issue
    function createNewIssue() {
      const titleInput = document.getElementById('issueTitle');
      const bodyInput = document.getElementById('issueBody');
      
      if (!titleInput.value.trim()) {
        titleInput.focus();
        titleInput.style.borderColor = '#e74c3c';
        setTimeout(() => titleInput.style.borderColor = '#e0e0e0', 2000);
        showErrorNotification(langData[currentLang].pleaseTitle);
        return;
      }

      const baseUrl = 'https://github.com/halei0v0/halei-s-warehouse/issues/new';
      const params = new URLSearchParams({
        title: titleInput.value.trim(),
        body: bodyInput.value.trim(),
        labels: 'user-generated'
      });

      const newWindow = window.open(`${baseUrl}?${params.toString()}`, '_blank');
      
      if (newWindow) {
        titleInput.value = '';
        bodyInput.value = '';
        showSuccessNotification(langData[currentLang].createSuccess);
      }
    }

    function escapeHtml(unsafe) {
      return unsafe.toString()
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    function generateProxyUrl(url) {
      return `https://ghproxy.net/${encodeURI(url)}`;
    }

    function formatFileSize(bytes) {
      const units = ['Bytes', 'KB', 'MB', 'GB'];
      if (bytes == 0) return '0 Bytes';
      const exp = Math.floor(Math.log(bytes) / Math.log(1024));
      return `${(bytes / Math.pow(1024, exp)).toFixed(2)} ${units[exp]}`;
    }

    // 错误提示功能
    function showErrorNotification(message) {
      const notification = document.createElement('div');
      notification.className = 'error-notification';
      notification.innerHTML = `
        <div class="error-content">
          <span><i class="fas fa-exclamation-circle"></i> ${escapeHtml(message)}</span>
          <button class="close-button"><i class="fas fa-times"></i></button>
        </div>
      `;
      document.body.appendChild(notification);
      notification.querySelector('.close-button').onclick = () => notification.remove();
      setTimeout(() => notification.remove(), 5000);
      notification.style.position = 'fixed';
      notification.style.bottom = '20px';
      notification.style.right = '20px';
      notification.style.backgroundColor = '#ffebee';
      notification.style.color = '#c62828';
      notification.style.padding = '15px 25px';
      notification.style.borderRadius = '8px';
      notification.style.zIndex = '10000';
      notification.style.display = 'flex';
      notification.style.alignItems = 'center';
      notification.style.gap = '10px';
      const closeBtn = notification.querySelector('.close-button');
      closeBtn.style.background = 'none';
      closeBtn.style.border = 'none';
      closeBtn.style.cursor = 'pointer';
      closeBtn.style.color = '#c62828';
      closeBtn.style.fontSize = '1.2rem';
    }
    function showSuccessNotification(message) {
      const notification = document.createElement('div');
      notification.className = 'success-notification';
      notification.innerHTML = `
        <div class="success-content">
          <span><i class="fas fa-check-circle"></i> ${escapeHtml(message)}</span>
          <button class="close-button"><i class="fas fa-times"></i></button>
        </div>
      `;
      document.body.appendChild(notification);
      notification.querySelector('.close-button').onclick = () => notification.remove();
      setTimeout(() => notification.remove(), 5000);
      notification.style.position = 'fixed';
      notification.style.bottom = '20px';
      notification.style.right = '20px';
      notification.style.backgroundColor = '#e8f5e9';
      notification.style.color = '#2e7d32';
      notification.style.padding = '15px 25px';
      notification.style.borderRadius = '8px';
      notification.style.zIndex = '10000';
      notification.style.display = 'flex';
      notification.style.alignItems = 'center';
      notification.style.gap = '10px';
      const closeBtn = notification.querySelector('.close-button');
      closeBtn.style.background = 'none';
      closeBtn.style.border = 'none';
      closeBtn.style.cursor = 'pointer';
      closeBtn.style.color = '#2e7d32';
      closeBtn.style.fontSize = '1.2rem';
    }

    // 初始化
    document.addEventListener('DOMContentLoaded', () => {
      initialize();
      updateLangUI();
    });
  </script>
</body>
</html>